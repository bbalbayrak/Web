{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/AlperenAlihanEr/portal-test/client/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _regeneratorRuntime from\"C:/Users/AlperenAlihanEr/portal-test/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/AlperenAlihanEr/portal-test/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/Users/AlperenAlihanEr/portal-test/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/AlperenAlihanEr/portal-test/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{getWorkById,createWorkStep,updateWorkStepStatus,getQRQuestionsByWorkId,getProductById}from'./worksapi';import{useNavigate,useLocation}from'react-router-dom';import'./Certificate.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Certificate=function Certificate(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),files=_useState2[0],setFiles=_useState2[1];var location=useLocation();var navigate=useNavigate();var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),product=_useState4[0],setProduct=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),work=_useState6[0],setWork=_useState6[1];var searchParams=new URLSearchParams(location.search);var work_id=searchParams.get('work_id');var step_id=searchParams.get('step_id');var handleFileChange=function handleFileChange(e){setFiles([].concat(_toConsumableArray(files),_toConsumableArray(Array.from(e.target.files))));};useEffect(function(){var searchParams=new URLSearchParams(location.search);var work_id=searchParams.get('work_id');var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var workData,productData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getWorkById(work_id);case 2:workData=_context.sent;setWork(workData);_context.next=6;return getProductById(workData.data.product_id);case 6:productData=_context.sent;setProduct(productData);case 8:case\"end\":return _context.stop();}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[location]);var handleSend=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _iterator,_step,file,formData,workStepData;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!(files.length>0)){_context2.next=28;break;}_iterator=_createForOfIteratorHelper(files);_context2.prev=2;_iterator.s();case 4:if((_step=_iterator.n()).done){_context2.next=20;break;}file=_step.value;formData=new FormData();formData.append('certificate_file',file);formData.append('work_id',work_id);// formData.append('product_id', product.data.id);\nformData.append('step_id',step_id);_context2.prev=10;_context2.next=13;return axios.post('http://localhost:3001/certificates',formData,{headers:{'Content-Type':'multipart/form-data'}});case 13:_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](10);console.error(_context2.t0);case 18:_context2.next=4;break;case 20:_context2.next=25;break;case 22:_context2.prev=22;_context2.t1=_context2[\"catch\"](2);_iterator.e(_context2.t1);case 25:_context2.prev=25;_iterator.f();return _context2.finish(25);case 28:_context2.prev=28;_context2.next=31;return updateWorkStepStatus(step_id,'Closed');case 31:_context2.next=36;break;case 33:_context2.prev=33;_context2.t2=_context2[\"catch\"](28);console.error(\"Error updating work step status: \".concat(_context2.t2.message));case 36:_context2.prev=36;workStepData={work_id:work.data.id,step_name:'QR Certificate',timestamp:new Date().toISOString(),state:'QR Certificate',status:'Open'};_context2.next=40;return createWorkStep(workStepData);case 40:_context2.next=45;break;case 42:_context2.prev=42;_context2.t3=_context2[\"catch\"](36);console.error(\"Error creating new work step: \".concat(_context2.t3.message));case 45:navigate('/workorders');case 46:case\"end\":return _context2.stop();}},_callee2,null,[[2,22,25,28],[10,15],[28,33],[36,42]]);}));return function handleSend(){return _ref2.apply(this,arguments);};}();var handleContinueWithoutSending=function handleContinueWithoutSending(){navigate('/workorders');};return/*#__PURE__*/_jsxs(\"div\",{className:\"form-page-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Certificate\"}),work&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Work Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Order Number: \",work.data.order_number]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Project Number: \",work.data.project_number]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"file-thumbnails\",children:files.map(function(file,index){return/*#__PURE__*/_jsx(\"div\",{className:\"file-thumbnail\",children:/*#__PURE__*/_jsx(\"img\",{src:URL.createObjectURL(file),alt:file.name,className:\"file-thumbnail-img\"})},index);})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,onChange:handleFileChange}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,className:\"btn btn-primary\",children:\"G\\xF6nder\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleContinueWithoutSending,className:\"btn btn-secondary\",children:\"G\\xF6ndermeden Devam Et\"})]});};export default Certificate;","map":{"version":3,"names":["React","useState","useEffect","axios","getWorkById","createWorkStep","updateWorkStepStatus","getQRQuestionsByWorkId","getProductById","useNavigate","useLocation","jsx","_jsx","jsxs","_jsxs","Certificate","_useState","_useState2","_slicedToArray","files","setFiles","location","navigate","_useState3","_useState4","product","setProduct","_useState5","_useState6","work","setWork","searchParams","URLSearchParams","search","work_id","get","step_id","handleFileChange","e","concat","_toConsumableArray","Array","from","target","fetchData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","workData","productData","wrap","_callee$","_context","prev","next","sent","data","product_id","stop","apply","arguments","handleSend","_ref2","_callee2","_iterator","_step","file","formData","workStepData","_callee2$","_context2","length","_createForOfIteratorHelper","s","n","done","value","FormData","append","post","headers","t0","console","error","t1","f","finish","t2","message","id","step_name","timestamp","Date","toISOString","state","status","t3","handleContinueWithoutSending","className","children","order_number","project_number","map","index","src","URL","createObjectURL","alt","name","type","multiple","onChange","onClick"],"sources":["C:/Users/AlperenAlihanEr/portal-test/client/src/components/Works/Certificate.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport {  getWorkById, createWorkStep,  updateWorkStepStatus,  getQRQuestionsByWorkId, getProductById} from './worksapi';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport './Certificate.css';\r\n\r\nconst Certificate = () => {\r\n  const [files, setFiles] = useState([]);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const [product, setProduct] = useState(null);\r\n  const [work, setWork] = useState(null);\r\n  const searchParams = new URLSearchParams(location.search);\r\n  const work_id = searchParams.get('work_id');\r\n  const step_id = searchParams.get('step_id');\r\n\r\n  const handleFileChange = (e) => {\r\n    setFiles([...files, ...Array.from(e.target.files)]);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const searchParams = new URLSearchParams(location.search);\r\n    const work_id = searchParams.get('work_id');\r\n\r\n    const fetchData = async () => {\r\n      const workData = await getWorkById(work_id);\r\n      setWork(workData);\r\n\r\n      const productData = await getProductById(workData.data.product_id);\r\n      setProduct(productData);\r\n    };\r\n\r\n    fetchData();\r\n  }, [location]);\r\n\r\n\r\n  const handleSend = async () => {\r\n    if (files.length > 0) {\r\n      for (const file of files) {\r\n        const formData = new FormData();\r\n        formData.append('certificate_file', file);\r\n        formData.append('work_id', work_id);\r\n        // formData.append('product_id', product.data.id);\r\n        formData.append('step_id', step_id);\r\n  \r\n        try {\r\n          await axios.post('http://localhost:3001/certificates', formData, {\r\n            headers: { 'Content-Type': 'multipart/form-data' },\r\n          });\r\n        } catch (error) {\r\n          console.error(error);\r\n        }\r\n      }\r\n    }\r\n\r\n    try {\r\n      await updateWorkStepStatus(step_id, 'Closed');\r\n    } catch (error) {\r\n      console.error(`Error updating work step status: ${error.message}`);\r\n    }\r\n  \r\n    try {\r\n      const workStepData = {\r\n        work_id: work.data.id,\r\n        step_name: 'QR Certificate',\r\n        timestamp: new Date().toISOString(),\r\n        state: 'QR Certificate',\r\n        status: 'Open',\r\n      };\r\n       await createWorkStep(workStepData);\r\n    } catch (error) {\r\n      console.error(`Error creating new work step: ${error.message}`);\r\n    }\r\n  \r\n    navigate('/workorders');\r\n  };\r\n\r\n  const handleContinueWithoutSending = () => {\r\n    navigate('/workorders');\r\n  };\r\n\r\n  return (\r\n    <div className=\"form-page-container\">\r\n      <h2>Certificate</h2>\r\n      {work && (\r\n        <div>\r\n          <h3>Work Details</h3>\r\n          <p>Order Number: {work.data.order_number}</p>\r\n          <p>Project Number: {work.data.project_number}</p>\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"file-thumbnails\">\r\n        {files.map((file, index) => (\r\n          <div key={index} className=\"file-thumbnail\">\r\n            <img\r\n              src={URL.createObjectURL(file)}\r\n              alt={file.name}\r\n              className=\"file-thumbnail-img\"\r\n            />\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <input type=\"file\" multiple onChange={handleFileChange} />\r\n      <br></br>\r\n      <button onClick={handleSend} className=\"btn btn-primary\">\r\n        Gönder\r\n      </button>\r\n      <button onClick={handleContinueWithoutSending} className=\"btn btn-secondary\">\r\n        Göndermeden Devam Et\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Certificate;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}